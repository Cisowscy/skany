<!DOCTYPE html>
<html lang="pl">

<head>
    <title>Metryki AGAD</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv='Content-Type' content='text/html; charset=utf-8'/>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
</head>

<body>
    <div id='printoutPanel'></div>
        
        <div id='myMap'></div>
        <script type='text/javascript'>
                var map;
                function loadMapScenario() {
                    map = new Microsoft.Maps.Map(document.getElementById('myMap'), {
                        credentials: 'Ag_DhhI4OhAJ28lJwiqxdE65HfSBWC3PT3MY1fYYlLd3vJpYMifcNlFA1-ZrMi7P'
                    });
                }
                
            
        </script>
        <script type='text/javascript' src='https://www.bing.com/api/maps/mapcontrol?branch=experimental&callback=loadMapScenario' async defer></script>
    <br><hr />
    <h3><a href="http://skany.cisowscy.com/"> Nowsza Wersja (Wtrakcie Budowy ale ju偶 dziaa w 60%)</a></h3>
    <hr /><br>
    <h2>Dziki tej prostej sztuczce mo偶esz w prosty spos贸b wywietli wszystkie skany danej ksigi metrykalnej z AGAD-u na jednej
        stronie, a nastpnie zapisujc ow ston, zapisa wszystkie skany na dysku, jedn prost czynnoci.</h2>
    <div>
        <b>KRTKI INSTRUKTA呕</b>
        <ol>
            <li><b>Wejd藕 na stron <a href="http://www.agad.gov.pl/inwentarze/testy.html">http://www.agad.gov.pl/inwentarze/testy.html</a> i otw贸rz skany interesujcej Ci pozycji np.:</b>
                <i><table>
                    <tr>
                        <td>Sygn.:</td>
                        <td>126</td>
                    </tr>
                    <tr>
                        <td>Tytu:</td>
                        <td>Par. Buczacz, dek. Buczacz; Ksiga metrykalna chrzt贸w dla caej parafii</td>
                    </tr>
                    <tr>
                        <td>Daty:</td>
                        <td>1752-1777</td>
                    </tr>
                    <tr>
                        <td>Opis:</td>
                        <td>ksiga oprawna, s. 320</td>
                    </tr>
                    <tr>
                        <td>Dawna Sygn.:</td>
                        <td>P-862, 36/2</td>
                    </tr>
                    <tr>
                        <td>Skany:</td>
                        <td><a href="http://agadd.home.net.pl/metrykalia/301/sygn.%20126/indeks.htm">http://agadd.home.net.pl/metrykalia/301/sygn.%20126/indeks.htm</a></td>
                    </tr>
                    <tr>
                        <td>Jzyk:</td>
                        <td>ac.</td>
                    </tr>
                    <tr>
                        <td colspan="2">wpisy bez rubryk; ksiga przekazana do AGAD z AP - Przemyl w 1993 r. <br>Mikrofilm: 73922</td>
                    </tr>
                </table></i><br>
            </li>
            <li><b>Nastpnie otw贸rz pierwszy element (metryczke) i skopiuj adres jego linku <br>np.
                </b><a href="http://agadd.home.net.pl/metrykalia/301/sygn.%20126/pages/PL_1_301_126_0000-metryczka.htm">http://agadd.home.net.pl/metrykalia/301/sygn.%20126/pages/PL_1_301_126_0000-metryczka.htm</a><b>, i wklej go poni偶ej</b><br><br>
                <form name="f1">
                    <input name="adresHTML_metryczki" id="adresHTML_metryczki" type="text" size="125" /> <br />
                </form> <br></li>
            <li><b>Nastpnie udaj si na sam koniec i otw贸rz ostatni skan poprzedzajcy tablic kocow, i skopiuj adres jego linku <br>np.
                </b><a href="http://agadd.home.net.pl/metrykalia/301/sygn.%20126/pages/PL_1_301_126_0161.htm">http://agadd.home.net.pl/metrykalia/301/sygn.%20126/pages/PL_1_301_126_0161.htm</a><b>, i wklej poni偶ej</b><br><br>
                <form name="f2">
                    <input name="adresHTML_ostatniego" id="adresHTML_ostatniego" type="text" size="125" /> <br />
                </form> <br>
                <button type="button" id="load_us">Zaladuj</button>&nbsp;&nbsp;&nbsp;<button type="button" id="view1">Widok miniatur</button> <button type="button" id="view2">Widok peny</button>
            </li>
            <!--<li><b>Jeli zostay poprawnie wprowadzone powy偶sze adresy ten tekst zniknie i zostan wywietlone Wszystkie Skany, nastpnie zapisz stron aby zapisa wszystkie elementy Dzikuj za uwag,   </b><br></li>-->
        </ol>
    </div>
    <hr>
    <div id="results_info"></div>
    <div id="results" class="thumbs"></div>
    <hr>

    <style>
    .thumbs .photo{
      display: inline-block;
      width: 100px;
      margin: 10px;
    }
    .full .photo{
      display: block; width: 100%;
      margin-bottom: 10px;
    }
    .photo.loading{
      border: 3px solid green;
    }
    .photo.failed{
      border: 3px solid red;
    }
    #myMap {
        width: 100vw; 
        height: 200px;
        }
    </style>
    <script type="text/javascript">
        const html_img_a = '<img class="photo loading thumb" onload="$(this).removeClass(\'loading\')" onerror="$(this).removeClass(\'loading\').addClass(\'failed\');" src="';
        const html_img_z = '" style="">';
        const c = ".jpg";
        $(function () {

            $(document).on('click', '#view1', function(){
                $('#results').addClass('thumbs').removeClass('full');
            });
            $(document).on('click', '#view2', function(){
                $('#results').removeClass('thumbs').addClass('full');
            });

            $(document).on('click', '#load_us', function(){

                var adresHTML_metryczki = $('#adresHTML_metryczki').val();
                if (adresHTML_metryczki.indexOf('pages') >= 0) {
                    var adresJPG_metryczki = adresHTML_metryczki.replace("pages", "images");
                    if (adresJPG_metryczki.indexOf('0000') >= 0) {
                        var adres_katalogu = adresJPG_metryczki.slice(0, adresJPG_metryczki.indexOf(
                            '0000'));
                    }
                }
                if(adres_katalogu == undefined){
                  return false;
                }
                var szukaj = adres_katalogu.slice(adres_katalogu.indexOf('images') + 7, adres_katalogu.length);

                //$(document).on('change', '#adresHTML_ostatniego', function(){

                    var adresHTML_ostatniego = $('#adresHTML_ostatniego').val();
                    console.log(adresHTML_ostatniego);
                    var liczba = Number(adresHTML_ostatniego.slice(adresHTML_ostatniego.indexOf(
                        szukaj) + szukaj.length, adresHTML_ostatniego.indexOf(
                        szukaj) + szukaj.length + 4));

                    if(liczba == 0){
                      alert("0 element贸w.");
                      return;
                    }

                    $('#results_info').html('loading...');

                    //document.write("<b><h1>PONI呕EJ ZNAJDUJ SI WSZYSTKIE SKANY (</h1></b>" +
                    //    liczba + " element贸w JPG)<br/>");
                    //document.write(html_img_a + adres_katalogu + "0000-metryczka" + c +
                    //    html_img_z + "<br>");
                    //document.write(html_img_a + adres_katalogu + "0000-tablica%20poczatkowa" +
                    //    c + html_img_z + "<br>");

                    var url_start = Number(1);
                    var arr = new Array();
                    while (url_start <= liczba) {
                        arr.push(url_start++);
                    }

                    var load_part = function(){
                        if(arr.length == 0){
                          $('#results_info').html('Koniec');
                          return;
                        }

                        var not_loaded = $('.photo.loading').length;

                        var i = 0;
                        for (var v in arr) {
                            if(i>5-not_loaded) break;

                            v = arr.pop();
                            i++;
                            function zera(v) {
                                var i = 0;
                                do {
                                    v = Math.floor(v / 10);
                                    i++;
                                } while (v > 0);
                                return i;
                            }

                            $('#results_info').html('Pozostao: ' + arr.length);

                            //$('#results_info').html('Loading ' + i + '/' + liczba);
                            //i++;

                            var photo = '';
                            if (zera(v) < 2) {
                                photo = html_img_a + adres_katalogu + "000" + v + c + html_img_z;
                            } else if (zera(v) < 3) {
                                photo = html_img_a + adres_katalogu + "00" + v + c + html_img_z;
                            } else if (zera(v) < 4) {
                                photo = html_img_a + adres_katalogu + "0" + v + c + html_img_z;
                            } else {
                                photo = html_img_a + adres_katalogu + v + c + html_img_z;
                            }

                            //console.log(photo);
                            $(photo).appendTo($('#results'));
                        }

                        setTimeout(load_part, 1000);
                    };
                    load_part();


                    //document.write(html_img_a + adres_katalogu + "9999-tablica%20koncowa" + c +
                    //    html_img_z + "<br>");
                    //return false;
                //});
                return false;
            });
        });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-93512619-1', 'auto');
  ga('send', 'pageview');

</script>
</body>

</html>
